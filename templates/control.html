<!-- Libraries for JSBayes-viz -->

<script>
  function getGraph_{{html_element_id}}() {
    
    var graph = jsbayes.newGraph();
    graph.saveSamples = false;
    
    <!-- Add nodes to graph -->
    {% for node in bn_model.nodes %}
    var {{ node }} = graph.addNode( '{{ node }}', [{% for state in bn_model.states[node] %} '{{ state }}',  {% endfor %}]);
    {% endfor %}
    
    <!-- Add edges to graph -->
    {% for parent, child in bn_model.edges %}
    {{child}}.addParent({{parent}});
    {% endfor %}
    
    <!-- Add CPDs to graph -->
    {% for node in bn_model.nodes %}
    {{node}}.setCpt({{squeeze_fn(bn_model.get_cpds(node).values.T.reshape((-1,2))).tolist()}});
    {% endfor %}

    graph.sample(20000);

    var g = jsbayesviz.fromGraph(graph);
    return g;
  }
      
  $(document).ready(function() {
    (function(window) { 
      var graph_{{html_element_id}} = getGraph_{{html_element_id}}();
      jsbayesviz.draw({
        id: '#{{html_element_id}}',
        width: $(window).width() * 0.6,
        height: $(window).height() * 0.6,
        graph: graph_{{html_element_id}},
        samples: 15000
      });
      
      
    })(window);
  });
</script>

<svg id="{{html_element_id}}"></svg>
