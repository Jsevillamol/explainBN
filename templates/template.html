<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    svg { border: 1px solid black; }
    svg g rect.node-shape { border-radius: 5px !important; fill:#cceeff !important; cursor: move; }
    svg g text.node-name { font-weight: 800 !important }
    svg g rect.node-bar { fill: DodgerBlue !important }
    svg g text.node-value { fill:rgb(0,0,0) !important; font-size: 15px; cursor: pointer; }
    svg line.edge-line { stroke:rgb(0,0,0) !important }
    svg path.edge-head { fill:rgb(0,0,0) !important }
  </style>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='node_modules/d3/d3.js') }}"></script>
  <script src="{{ url_for('static', filename='node_modules/lodash/lodash.js') }}"></script>
  <script src="{{ url_for('static', filename='node_modules/graphlib/dist/graphlib.core.js') }}"></script>
  <script src="{{ url_for('static', filename='node_modules/dagre/dist/dagre.core.js') }}"></script>
  <script src="{{ url_for('static', filename='node_modules/jsbayes/jsbayes.js') }}"></script>
  <script src="{{ url_for('static', filename='node_modules/jsbayes-viz/jsbayes-viz.js') }}"></script>
	  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="stylenav.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script>
    function getGraph() {
      
      var graph = jsbayes.newGraph();
      graph.saveSamples = false;
      
      <!-- Add nodes to graph -->
      {% for node in bn_model.nodes %}
      var {{ node }} = graph.addNode( '{{ node }}', [{% for state in bn_model.states[node] %} '{{ state }}',  {% endfor %}]);
      {% endfor %}
      
      <!-- Add edges to graph -->
      {% for parent, child in bn_model.edges %}
      {{child}}.addParent({{parent}});
      {% endfor %}
      
      <!-- Add CPDs to graph -->
      {% for node in bn_model.nodes %}
      {{node}}.setCpt({{squeeze_fn(bn_model.get_cpds(node).values.T.reshape((-1,2))).tolist()}});
      {% endfor %}

      graph.sample(20000);

      var g = jsbayesviz.fromGraph(graph);
      return g;
    }
        
    $(document).ready(function() {
      (function(window) { 
        var graph = getGraph();
        jsbayesviz.draw({
          id: '#bbn',
          width: 800,
          height: 800,
          graph: graph,
          samples: 15000
        });
        
        
      })(window);
    });
  </script>
  <title>Survey Bayesian Networks</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  
  <!-- Code for the SurveyJS -->
  <link href="https://unpkg.com/survey-jquery@1.8.60/modern.css" type="text/css" rel="stylesheet" />
  <script src="https://unpkg.com/survey-jquery@1.8.60/survey.jquery.min.js"></script>
  
</head>

<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-customclass">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="/template.html" style="color: #BC2F31"><strong>Survey</strong></a>

      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      <sapn class="icon-bar"></sapn>
      </button>
    </div>
    <ul class="nav navbar-nav navbar-right collapse navbar-collapse">
      <li class="active"><a href="#info">Information</a></li>
	      <li><a href="#consent">Consent Form</a></li>
      <li><a href="#q1">Q1</a></li>
		<li><a href="#q2">Q2</a></li>
		<li><a href="#q3">Q3</a></li>
		<li><a href="#q4">Q4</a></li>
    </ul>
  </div>
</nav>

<div class="jumbotron text-center">
<h1>Survey on Bayesian Networks</h1>
</div>

<div class="container">
  <div class="row">
	  <h1 id="info">Participants Information</h1>
	  
	 <h4>
Thank you for helping us test our Bayesian Network explainer system.

<br>Here you will see a Bayesian Network, some evidence and an explained output.

<br>The Bayesian Network we will be using as an example is used for medical diagnosis. 
<br>In particular, it is used to determine the chances that a patient has lung cancer, given their symptoms, risk factors and medical history.
 </h4>
	  
	</div>
	<hr>
	
	<div class="row"> 	  <h1 id="consent">Consent Form</h1> </div>

	
	 <div class="row">
	  <h1 id="q1">Q1</h1>
	  
	 <p class="textbig">

<br>Here you will see a Bayesian Network, some evidence and an explained output.

<br>The Bayesian Network we will be using as an example is used for medical diagnosis. 
<br>In particular, it is used to determine the chances that a patient has lung cancer, given their symptoms, risk factors and medical history.
 </p>
	  
	

  <!-- Bayesian Network graph -->
	<img src="{{ url_for('static', filename=bn_graph) }}" />
	</div>
	 <hr> 
	  
	<div class="row" id="q2"> 	  
  <!-- Table with explanation of the variables in the BN -->
  {{ variable_description|safe }}
	</div>
  
  <!-- Relation of evidence -->
  <div>
    {% if evidence_explanation|length == 0 %}
    <p> We have no additional evidence </p>
    {% else %}
    <p> We have observed that: </p>
    {% endif %}
    <ul>
    {% for line in evidence_explanation %}
      <li>{{ line }}</li>
    {% endfor %}
    </ul>
  </div>
	 
	   <p class="textbig" id="q3">
  <!-- Interactive container with the explanation -->
  {% for output in interactive_output %}
    <div class="tabcontent">
    {% for line in output.text %}
      <p> {{ line }} </p> <hr>
    {% endfor %}
    <img src="{{ url_for('static', filename=output.img) }}" />
    </div>
  {% endfor %}
    </p> <hr>
	
	<p class="textbig" id="q4">
  <!-- Javascript visualization -->
  <svg id="bbn"></svg>
  
		</p> <hr>
   
  <!-- SurveyJS container -->
	<div id="surveyContainer"></div>
  <script>
  Survey.StylesManager.applyTheme("modern");
  
  function sendDataToServer(survey) {
    survey.setValue("bn", "asia")
    survey.setValue("p", 0.2)
    survey.setValue("is_treatment", true)
    survey.setValue("mistake", "No mistake")
    survey.sendResult('2fd3f481-70d1-4b40-ab8b-611d89238ad5');
  }

  var surveyJSON = { surveyId: 'b48b6122-d333-462a-bd57-34ca878560e7', 
                     surveyPostId: '2fd3f481-70d1-4b40-ab8b-611d89238ad5'}

  var survey = new Survey.Model(surveyJSON);
  
  $("#surveyContainer").Survey({
      model: survey,
      onComplete: sendDataToServer
  });
  
  

  </script>
  
  
  
  
  </div>
</div>   
    
</body>
</html>
